<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½œä¸šæ’­æŠ¥ - YoBox</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“–</text></svg>">

    <style>
        :root {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --accent: #ff9500;
            --accent-hover: #e68600;
            --border: #d2d2d7;
            color-scheme: light dark;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "PingFang SC", sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--accent);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* ä¸»å†…å®¹åŒº */
        main {
            flex: 1;
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            padding: 24px 20px;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 20px;
        }

        .section-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .char-count {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        textarea {
            width: 100%;
            min-height: 180px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
            line-height: 1.8;
        }

        textarea:focus {
            border-color: var(--accent);
        }

        textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        /* æ§åˆ¶åŒºåŸŸ */
        .controls-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 20px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-size: 14px;
            font-weight: 500;
            min-width: 70px;
        }

        select {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            background: #f5f5f7;
            outline: none;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        select:focus {
            border-color: var(--accent);
        }

        /* è¯­é€Ÿæ»‘å— */
        .speed-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: rgba(0,0,0,0.1);
            border-radius: 3px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(255,149,0,0.3);
        }

        .speed-slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(255,149,0,0.3);
        }

        .speed-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent);
            min-width: 45px;
            text-align: right;
        }

        /* æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 100px;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(255,149,0,0.25);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(118,118,128,0.12);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(118,118,128,0.18);
        }

        /* çŠ¶æ€æ˜¾ç¤º */
        .status-bar {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-secondary);
            transition: background 0.3s;
        }

        .status-indicator.playing {
            background: #34c759;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .status-indicator.paused {
            background: #ff9500;
        }

        .status-indicator.loading {
            background: #007aff;
            animation: pulse 1s ease-in-out infinite;
        }

        .status-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ç¤ºä¾‹æŒ‰é’® */
        .example-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .example-btn {
            padding: 6px 12px;
            background: rgba(118,118,128,0.1);
            border: none;
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: background 0.2s;
        }

        .example-btn:hover {
            background: rgba(118,118,128,0.16);
        }

        /* æš—è‰²æ¨¡å¼ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0b0b0c;
                --card-bg: #161618;
                --text-primary: #f5f5f7;
                --text-secondary: #a1a1a6;
                --border: rgba(255,255,255,0.1);
            }

            header {
                background: rgba(22, 22, 24, 0.85);
            }
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            main {
                padding: 16px;
            }

            .input-section, .controls-section {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        :is(button, a, textarea, select):focus-visible {
            outline: 3px solid rgba(255, 149, 0, 0.4);
            outline-offset: 3px;
            border-radius: 12px;
        }
    </style>
</head>
<body>

    <header>
        <a href="../" class="back-link">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2.5" fill="none">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            è¿”å›
        </a>
        <span class="header-title">ğŸ“– ä½œä¸šæ’­æŠ¥</span>
    </header>

    <main>
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-section">
            <div class="section-label">
                <span>è¾“å…¥ä½œä¸šå†…å®¹</span>
                <span class="char-count" id="charCount">0 å­—</span>
            </div>
            <textarea
                id="textInput"
                placeholder="è¯·ç²˜è´´è€å¸ˆå‘çš„ä½œä¸šæ–‡å­—...&#10;&#10;ä¾‹å¦‚ï¼š&#10;ä»Šå¤©è¯­æ–‡ä½œä¸šï¼š&#10;1. å¤ä¹ ç¬¬1-5è¯¾ç”Ÿå­—ï¼Œæ¯ä¸ªå­—å†™3é&#10;2. é¢„ä¹ ç¬¬6è¯¾ï¼Œæœ—è¯»è¯¾æ–‡3é&#10;3. èƒŒè¯µå¤è¯—ã€Šé™å¤œæ€ã€‹"
            ></textarea>
            <div class="example-buttons">
                <button class="example-btn" onclick="loadExample(1)">è¯­æ–‡ä½œä¸šç¤ºä¾‹</button>
                <button class="example-btn" onclick="loadExample(2)">æ•°å­¦ä½œä¸šç¤ºä¾‹</button>
                <button class="example-btn" onclick="loadExample(3)">ç»¼åˆä½œä¸šç¤ºä¾‹</button>
            </div>
        </div>

        <!-- æ§åˆ¶åŒºåŸŸ -->
        <div class="controls-section">
            <div class="section-label">æ’­æ”¾è®¾ç½®</div>

            <div class="control-row">
                <span class="control-label">å£°éŸ³</span>
                <select id="voiceSelect">
                    <option value="zh-CN-XiaoxiaoNeural">æ™“æ™“ (å¥³å£°, æ¸©æŸ”)</option>
                    <option value="zh-CN-YunxiNeural">äº‘å¸Œ (ç”·å£°, æ¸©æš–)</option>
                    <option value="zh-CN-YunyangNeural">äº‘æ‰¬ (ç”·å£°, æˆç†Ÿ)</option>
                    <option value="zh-CN-XiaoyiNeural">æ™“ä¼Š (å¥³å£°, äº²åˆ‡)</option>
                    <option value="zh-CN-YunjianNeural">äº‘å¥ (ç”·å£°, ç¨³é‡)</option>
                </select>
            </div>

            <div class="control-row">
                <span class="control-label">è¯­é€Ÿ</span>
                <input type="range" class="speed-slider" id="speedSlider" min="0.5" max="2" step="0.1" value="1">
                <span class="speed-value" id="speedValue">1.0x</span>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="playBtn" onclick="togglePlay()">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    å¼€å§‹æ’­æ”¾
                </button>
                <button class="btn btn-secondary" id="stopBtn" onclick="stopSpeaking()" disabled>
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <rect x="6" y="6" width="12" height="12"/>
                    </svg>
                    åœæ­¢
                </button>
            </div>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-indicator" id="statusIndicator"></div>
            <div style="flex: 1;">
                <span class="status-text" id="statusText">å‡†å¤‡å°±ç»ª</span>
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // è·å–å…ƒç´ 
        const textInput = document.getElementById('textInput');
        const charCount = document.getElementById('charCount');
        const voiceSelect = document.getElementById('voiceSelect');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');

        // éŸ³é¢‘ç›¸å…³
        let audio = null;
        let isPlaying = false;
        let isLoading = false;

        // Edge TTS API (ä½¿ç”¨å…è´¹çš„å…¬å…± API)
        const EDGE_TTS_API = 'https://edge-tts.xiexin.tech/api/voice';

        // æ›´æ–°å­—æ•°ç»Ÿè®¡
        textInput.addEventListener('input', () => {
            charCount.textContent = `${textInput.value.length} å­—`;
        });

        // è¯­é€Ÿæ»‘å—
        speedSlider.addEventListener('input', () => {
            speedValue.textContent = `${parseFloat(speedSlider.value).toFixed(1)}x`;
        });

        // ç¤ºä¾‹æ–‡æœ¬
        const examples = {
            1: `ä»Šå¤©è¯­æ–‡ä½œä¸šï¼š
1. å¤ä¹ ç¬¬1-5è¯¾ç”Ÿå­—ï¼Œæ¯ä¸ªå­—å†™3é
2. é¢„ä¹ ç¬¬6è¯¾ï¼Œæœ—è¯»è¯¾æ–‡3éç»™å®¶é•¿å¬
3. èƒŒè¯µå¤è¯—ã€Šé™å¤œæ€ã€‹ï¼Œå¹¶é»˜å†™
4. å®Œæˆç»ƒä¹ å†Œç¬¬8é¡µ`,

            2: `ä»Šå¤©æ•°å­¦ä½œä¸šï¼š
1. å®Œæˆå£ç®—ç»ƒä¹ é¢˜ï¼Œç¬¬15é¡µåˆ°ç¬¬18é¡µ
2. å¤ä¹ 20ä»¥å†…çš„åŠ å‡æ³•ï¼Œå‡†å¤‡æ˜å¤©æµ‹éªŒ
3. å®Œæˆåº”ç”¨é¢˜3é“ï¼Œå†™åœ¨ä½œä¸šæœ¬ä¸Š
4. é¢„ä¹ ä¸‹ä¸€è¯¾ã€Šè®¤è¯†å›¾å½¢ã€‹`,

            3: `ä»Šæ—¥ä½œä¸šå®‰æ’ï¼š

è¯­æ–‡ï¼š
1. æœ—è¯»è¯¾æ–‡ã€Šç§‹å¤©ã€‹3é
2. ç”Ÿå­—æœ¬æŠ„å†™ç”Ÿå­—ï¼Œæ¯ä¸ªå­—å†™5é
3. å®Œæˆé…å¥—ç»ƒä¹ å†Œç¬¬10é¡µ

æ•°å­¦ï¼š
1. å£ç®—é¢˜å¡ç¬¬12é¡µ
2. å¤ä¹ å‡‘åæ³•

å…¶ä»–ï¼š
1. è·³ç»³100ä¸ª
2. é˜…è¯»20åˆ†é’Ÿè¯¾å¤–ä¹¦`
        };

        function loadExample(num) {
            textInput.value = examples[num];
            charCount.textContent = `${examples[num].length} å­—`;
            updateStatus('å·²åŠ è½½ç¤ºä¾‹æ–‡æœ¬', '');
        }

        function updateStatus(text, state) {
            statusText.textContent = text;
            statusIndicator.className = 'status-indicator';
            if (state) {
                statusIndicator.classList.add(state);
            }

            // æ˜¾ç¤º/éšè—è¿›åº¦æ¡
            if (state === 'playing') {
                progressBar.style.display = 'block';
            } else if (state === 'loading') {
                progressBar.style.display = 'block';
                progressFill.style.width = '100%';
                progressFill.style.animation = 'pulse 1s ease-in-out infinite';
            } else {
                progressBar.style.display = 'none';
                progressFill.style.animation = 'none';
            }
        }

        function updatePlayButton() {
            if (isPlaying) {
                playBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                    æš‚åœ
                `;
            } else {
                playBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    å¼€å§‹æ’­æ”¾
                `;
            }
        }

        async function togglePlay() {
            if (isLoading) return;

            if (isPlaying && audio) {
                // æš‚åœ/ç»§ç»­
                if (audio.paused) {
                    audio.play();
                    updateStatus('æ­£åœ¨æ’­æ”¾...', 'playing');
                } else {
                    audio.pause();
                    updateStatus('å·²æš‚åœ', 'paused');
                }
                updatePlayButton();
            } else {
                // å¼€å§‹æ–°æ’­æ”¾
                await speak();
            }
        }

        async function speak() {
            const text = textInput.value.trim();
            if (!text) {
                updateStatus('è¯·å…ˆè¾“å…¥è¦æ’­æŠ¥çš„å†…å®¹', '');
                return;
            }

            // åœæ­¢å½“å‰æ’­æ”¾
            if (audio) {
                audio.pause();
                audio = null;
            }

            isLoading = true;
            isPlaying = false;
            stopBtn.disabled = true;
            updateStatus('æ­£åœ¨ç”Ÿæˆè¯­éŸ³...', 'loading');
            updatePlayButton();

            try {
                const voice = voiceSelect.value;
                const rate = parseFloat(speedSlider.value);

                // è°ƒç”¨ Edge TTS API
                const response = await fetch(`${EDGE_TTS_API}?text=${encodeURIComponent(text)}&voice=${voice}&rate=${rate}`);

                if (!response.ok) {
                    throw new Error('API è¯·æ±‚å¤±è´¥');
                }

                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);

                audio = new Audio(audioUrl);

                audio.onplay = () => {
                    isLoading = false;
                    isPlaying = true;
                    stopBtn.disabled = false;
                    updateStatus('æ­£åœ¨æ’­æ”¾...', 'playing');
                    updatePlayButton();
                };

                audio.onended = () => {
                    isLoading = false;
                    isPlaying = false;
                    stopBtn.disabled = true;
                    updateStatus('æ’­æ”¾å®Œæˆ', '');
                    updatePlayButton();
                    URL.revokeObjectURL(audioUrl);
                };

                audio.onerror = () => {
                    isLoading = false;
                    isPlaying = false;
                    stopBtn.disabled = true;
                    updateStatus('æ’­æ”¾å‡ºé”™ï¼Œè¯·é‡è¯•', '');
                    updatePlayButton();
                    URL.revokeObjectURL(audioUrl);
                };

                audio.onpause = () => {
                    if (isPlaying) {
                        updateStatus('å·²æš‚åœ', 'paused');
                    }
                };

                await audio.play();

            } catch (error) {
                console.error('Speech error:', error);
                isLoading = false;
                isPlaying = false;
                stopBtn.disabled = true;
                updateStatus('ç”Ÿæˆè¯­éŸ³å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', '');
                updatePlayButton();
            }
        }

        function stopSpeaking() {
            if (audio) {
                audio.pause();
                audio = null;
            }
            isLoading = false;
            isPlaying = false;
            stopBtn.disabled = true;
            updatePlayButton();
            updateStatus('å·²åœæ­¢', '');
            progressBar.style.display = 'none';
        }

        // é¡µé¢å¸è½½æ—¶åœæ­¢æ’­æ”¾
        window.addEventListener('beforeunload', () => {
            if (audio) {
                audio.pause();
            }
        });

        // åˆå§‹åŒ–
        updateStatus('å‡†å¤‡å°±ç»ª', '');
    </script>

</body>
</html>
