<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç”Ÿå­—å·©å›ºï¼ˆåŒéŸ³/å½¢è¿‘ï¼‰- YoBox</title>
    <style>
        :root {
            --bg: #f5f5f7; --white: #fff; --text: #1d1d1f; --muted: #6e6e73; --border: #d2d2d7;
            --accent: #007aff; --shadow: 0 10px 40px rgba(0,0,0,0.08);
            --grid: rgba(40,120,70,0.85); --grid-soft: rgba(40,120,70,0.28);
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; background: var(--bg); display: flex; height: 100vh; overflow: hidden; color: var(--text); }
        :is(a, button, input, select, textarea):focus-visible { outline: 3px solid rgba(0, 122, 255, 0.35); outline-offset: 3px; border-radius: 12px; }

        .menu-btn { position: fixed; top: calc(env(safe-area-inset-top, 0px) + 12px); left: 12px; width: 44px; height: 44px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.12); background: rgba(255,255,255,0.85); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); display: none; align-items: center; justify-content: center; z-index: 300; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .menu-btn:active { transform: scale(0.98); }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); opacity: 0; pointer-events: none; transition: opacity 0.25s ease; z-index: 200; }
        .overlay.active { opacity: 1; pointer-events: auto; }

        .sidebar { width: 320px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-right: 1px solid rgba(0,0,0,0.10); display: flex; flex-direction: column; z-index: 100; transition: transform 0.3s; }
        .header { padding: 20px; border-bottom: 1px solid var(--border); position: relative; }
        .back-link { text-decoration: none; color: var(--accent); font-size: 13px; display: inline-flex; align-items: center; gap: 6px; font-weight: 700; }
        .title { margin-top: 10px; font-size: 20px; font-weight: 800; letter-spacing: -0.3px; display: flex; align-items: center; gap: 8px; }
        .subtitle { font-size: 12px; color: var(--muted); line-height: 1.45; margin-top: 8px; }
        .sidebar-close { position: absolute; right: 12px; top: calc(env(safe-area-inset-top, 0px) + 10px); width: 36px; height: 36px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.10); background: rgba(118,118,128,0.14); color: var(--text); display: none; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; line-height: 1; }

        .content-area { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 20px; display: flex; flex-direction: column; gap: 14px; }
        .control-card { background: var(--white); border: 1px solid rgba(0,0,0,0.06); border-radius: 18px; padding: 14px; box-shadow: 0 1px 0 rgba(255,255,255,0.6) inset; }
        .label { display: block; font-size: 12px; font-weight: 800; color: #8a8a8f; margin-bottom: 10px; }
        textarea, select {
            width: 100%; border-radius: 12px; border: 1px solid rgba(0,0,0,0.10); background: #f5f5f7; padding: 10px 12px;
            font-size: 14px; outline: none;
        }
        textarea { height: 88px; resize: none; }
        .row { display: flex; gap: 10px; }
        .row > div { flex: 1; }
        .actions { display: flex; flex-direction: column; gap: 10px; margin-top: 4px; }
        .btn { width: 100%; padding: 12px 12px; border-radius: 14px; border: none; cursor: pointer; font-size: 15px; font-weight: 900; transition: transform 0.08s, box-shadow 0.2s, background 0.2s; }
        .btn:active { transform: scale(0.99); }
        .btn-primary { background: var(--text); color: #fff; box-shadow: 0 8px 18px rgba(0,0,0,0.18); }
        .btn-secondary { background: #e9e9ee; color: var(--text); }

        .main { flex: 1; overflow-y: auto; padding: 28px 20px 40px; display: flex; justify-content: center; background: var(--bg); }
        .preview-stack { display: flex; flex-direction: column; gap: 22px; align-items: center; }
        .sheet { width: 210mm; height: 297mm; background: #fff; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.04); padding: 14mm 14mm 12mm; border-radius: 16px; }
        .sheet-header { display: flex; justify-content: space-between; align-items: flex-end; padding-bottom: 10px; border-bottom: 1.8px solid #111; margin-bottom: 10px; }
        .sheet-title { font-size: 20px; font-weight: 900; letter-spacing: -0.2px; }
        .meta { font-size: 12px; color: var(--muted); display: flex; gap: 14px; }
        .line { display: inline-block; border-bottom: 1px solid #333; min-width: 64px; transform: translateY(-1px); }

        .table { display: grid; grid-template-columns: 44mm 1fr 1fr; border: 1.4px solid rgba(0,0,0,0.18); border-radius: 12px; overflow: hidden; }
        .th, .td { padding: 10px 10px; border-bottom: 1px solid rgba(0,0,0,0.10); border-right: 1px solid rgba(0,0,0,0.10); }
        .th { background: rgba(118,118,128,0.10); font-weight: 900; font-size: 12px; color: rgba(60,60,67,0.85); }
        .td { min-height: 38mm; display: flex; flex-direction: column; gap: 8px; }
        .table > div:nth-child(3n) { border-right: none; }
        .table > div:nth-last-child(-n+3) { border-bottom: none; }

        .big-char { font-size: 28px; font-weight: 900; font-family: "KaiTi", "Kaiti SC", "STKaiti", serif; }
        .sub { font-size: 11px; color: var(--muted); }

        .grid3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6mm; }
        .box { width: 100%; aspect-ratio: 1 / 1; border: 1.4px solid var(--grid); position: relative; border-radius: 8px; overflow: hidden; }
        .box::before { content:""; position: absolute; left: 3px; right: 3px; top: 50%; border-top: 1px dashed var(--grid-soft); }
        .box::after { content:""; position: absolute; top: 3px; bottom: 3px; left: 50%; border-left: 1px dashed var(--grid-soft); }

        @media (max-width: 860px) {
            .menu-btn { display: inline-flex; }
            body { height: 100dvh; overflow: hidden; }
            .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: min(320px, 86vw); transform: translateX(-105%); box-shadow: 2px 0 24px rgba(0,0,0,0.18); border-right: 1px solid rgba(0,0,0,0.08); z-index: 250; }
            .sidebar.open { transform: translateX(0); }
            .sidebar-close { display: inline-flex; }
            .main { overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 68px 12px 28px; }
            .sheet { width: 100%; height: auto; min-height: auto; padding: 18px; border-radius: 14px; }
        }
        @media print {
            @page { size: A4 portrait; margin: 0; }
            html, body { width: 210mm; margin: 0; padding: 0; }
            body { display: block; height: auto; overflow: visible; background: #fff; }
            .sidebar, .menu-btn, .overlay { display: none !important; }
            .main { padding: 0; margin: 0; display: block; overflow: visible; }
            .sheet { box-shadow: none; border: none; border-radius: 0; width: 210mm; height: 297mm; margin: 0; padding: 14mm 14mm 12mm; }
        }
    </style>
</head>
<body>
    <button class="menu-btn" type="button" aria-label="æ‰“å¼€èœå•" onclick="toggleSidebar(true)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <line x1="4" y1="7" x2="20" y2="7"></line>
            <line x1="4" y1="12" x2="20" y2="12"></line>
            <line x1="4" y1="17" x2="20" y2="17"></line>
        </svg>
    </button>
    <div class="overlay" id="overlay" onclick="toggleSidebar(false)"></div>

    <aside class="sidebar" id="sidebar">
        <div class="header">
            <button class="sidebar-close" type="button" aria-label="å…³é—­èœå•" onclick="toggleSidebar(false)">Ã—</button>
            <a href="../" class="back-link">â† è¿”å› YoBox å¤§å…</a>
            <div class="title">ğŸ€„ï¸ ç”Ÿå­—å·©å›º</div>
            <div class="subtitle">åŒéŸ³å­— / å½¢è¿‘å­—å¯¹æ¯” + ç»„è¯ç»ƒä¹ ã€‚æ”¯æŒè‡ªå®šä¹‰ç”Ÿå­—åˆ—è¡¨ã€‚</div>
        </div>

        <div class="content-area">
            <div class="control-card">
                <label class="label">æ¨¡å¼</label>
                <select id="mode">
                    <option value="pairs" selected>å¯¹æ¯”ç»ƒä¹ ï¼ˆæ¯è¡Œ 2 ä¸ªå­—ï¼‰</option>
                    <option value="single">å•å­—å·©å›ºï¼ˆæ¯è¡Œ 1 ä¸ªå­—ï¼‰</option>
                </select>
            </div>
            <div class="control-card">
                <label class="label">ç”Ÿå­—ï¼ˆç©ºæ ¼/æ¢è¡Œåˆ†éš”ï¼‰</label>
                <textarea id="input">å¤© åœ° äºº é‡‘ æœ¨ æ°´ ç« åœŸ</textarea>
            </div>
            <div class="control-card">
                <label class="label">æ¯é¡µè¡Œæ•°</label>
                <div class="row">
                    <div>
                        <select id="rows">
                            <option value="4">4 è¡Œ</option>
                            <option value="5" selected>5 è¡Œ</option>
                            <option value="6">6 è¡Œ</option>
                        </select>
                    </div>
                    <div>
                        <select id="boxes">
                            <option value="2">æ¯å­— 2 æ ¼</option>
                            <option value="3" selected>æ¯å­— 3 æ ¼</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" type="button" id="regen">ğŸ”„ é‡æ–°æ’ç‰ˆ</button>
                <button class="btn btn-primary" type="button" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
            </div>
        </div>
    </aside>

    <main class="main">
        <div class="preview-stack">
            <section class="sheet" id="sheet"></section>
        </div>
    </main>

    <script>
        function toggleSidebar(forceOpen) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            if (!sidebar || !overlay) return;
            const open = typeof forceOpen === 'boolean' ? forceOpen : !sidebar.classList.contains('open');
            sidebar.classList.toggle('open', open);
            overlay.classList.toggle('active', open);
        }
        window.addEventListener('resize', () => { if (!window.matchMedia('(max-width: 860px)').matches) toggleSidebar(false); });

        const els = {
            mode: document.getElementById('mode'),
            input: document.getElementById('input'),
            rows: document.getElementById('rows'),
            boxes: document.getElementById('boxes'),
            sheet: document.getElementById('sheet'),
            regen: document.getElementById('regen')
        };

        function parseChars() {
            return els.input.value.split(/[\s,\n]+/).map(s => s.trim()).filter(Boolean);
        }

        function makeRow(label, a, b, boxes) {
            const left = `
                <div class="td">
                    <div class="big-char">${label}</div>
                    <div class="sub">æ‹¼éŸ³ï¼š_____  ç»„è¯ï¼š________</div>
                </div>
            `;
            function rightCell(ch) {
                if (!ch) return `<div class="td"><div class="grid3">${'<div class="box"></div>'.repeat(boxes)}</div></div>`;
                return `
                    <div class="td">
                        <div class="big-char">${ch}</div>
                        <div class="grid3">${'<div class="box"></div>'.repeat(boxes)}</div>
                    </div>
                `;
            }
            return left + rightCell(a) + rightCell(b);
        }

        function render() {
            const chars = parseChars();
            const mode = els.mode.value;
            const rows = parseInt(els.rows.value, 10);
            const boxes = parseInt(els.boxes.value, 10);
            const totalSlots = mode === 'pairs' ? rows * 2 : rows;

            const list = chars.slice(0, totalSlots);
            while (list.length < totalSlots) list.push('');

            const header = `
                <div class="sheet-header">
                    <div class="sheet-title">ç”Ÿå­—å·©å›ºç»ƒä¹ </div>
                    <div class="meta">
                        <span>å§“åï¼š<span class="line"></span></span>
                        <span>æ—¥æœŸï¼š<span class="line"></span></span>
                    </div>
                </div>
            `;

            let body = `<div class="table">
                <div class="th">æœ¬è¡Œä¸»é¢˜</div><div class="th">å­— A</div><div class="th">å­— B</div>
            `;
            for (let r = 0; r < rows; r++) {
                const a = mode === 'pairs' ? list[r * 2] : list[r];
                const b = mode === 'pairs' ? list[r * 2 + 1] : '';
                body += makeRow(`ç¬¬${r + 1}è¡Œ`, a, b, boxes);
            }
            body += `</div>`;

            els.sheet.innerHTML = header + body;
        }

        els.mode.addEventListener('change', render);
        els.rows.addEventListener('change', render);
        els.boxes.addEventListener('change', render);
        els.input.addEventListener('input', () => { clearTimeout(window.__t); window.__t = setTimeout(render, 250); });
        els.regen.addEventListener('click', render);
        window.addEventListener('load', render);
    </script>
</body>
</html>
