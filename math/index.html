<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°ä½è®¡æ•°å™¨ç”Ÿæˆå™¨ - YoBox</title>
    <style>
        :root { --app-bg: #f5f5f7; --accent: #ff9500; --text: #1d1d1f; --border: #d2d2d7; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; background: var(--app-bg); display: flex; height: 100vh; overflow: hidden; }
        
        .menu-btn {
            position: fixed;
            top: calc(env(safe-area-inset-top, 0px) + 12px);
            left: 12px;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.12);
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        .menu-btn:active { transform: scale(0.98); }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
            z-index: 200;
        }
        .overlay.active { opacity: 1; pointer-events: auto; }

        /* ä¾§è¾¹æ  */
        .sidebar { width: 300px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-right: 1px solid rgba(0,0,0,0.1); display: flex; flex-direction: column; padding: 20px; z-index: 10; position: relative; transition: transform 0.3s; }
        .back-link { text-decoration: none; color: var(--text); font-size: 14px; display: flex; align-items: center; gap: 5px; margin-bottom: 20px; opacity: 0.6; }
        .title { font-size: 20px; font-weight: 700; margin-bottom: 5px; color: var(--accent); }
        .subtitle { font-size: 12px; color: #888; margin-bottom: 30px; }

        .sidebar-close {
            position: absolute;
            right: 12px;
            top: calc(env(safe-area-inset-top, 0px) + 10px);
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.10);
            background: rgba(118,118,128,0.14);
            color: var(--text);
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }
        
        .control-group { margin-bottom: 20px; }
        .label { display: block; font-size: 12px; font-weight: 600; color: #666; margin-bottom: 8px; }
        select, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; background: #fff; margin-bottom: 10px; cursor: pointer; }
        .btn-print { background: var(--accent); color: white; border: none; font-weight: 600; margin-top: auto; }
        .btn-refresh { background: #f2f2f7; color: var(--text); border: none; }

        /* ä¸»åŒºåŸŸ */
        .main { flex: 1; display: flex; justify-content: center; overflow-y: auto; padding: 40px; }
        
        /* A4 çº¸å¼  */
        .sheet {
            width: 210mm; min-height: 297mm; background: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 15mm; box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10mm;
        }

        .problem-box {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px dashed #eee; border-radius: 10px; padding: 10px;
        }

        .counter-svg { width: 100px; height: 140px; overflow: visible; }
        
        .answer-area {
            margin-top: 10px; width: 100%; display: flex; justify-content: center; align-items: baseline; gap: 5px;
            font-family: "KaiTi", serif; font-size: 18px;
        }
        .bracket {
            border-bottom: 1px solid #333; width: 40px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-family: Arial, sans-serif;
        }
        .text-desc { font-size: 14px; color: #666; margin-top: 5px; }
        :is(button, a, select, input, textarea):focus-visible { outline: 3px solid rgba(255, 149, 0, 0.35); outline-offset: 3px; border-radius: 12px; }

        @media print {
            @page { size: A4 portrait; margin: 0; }
            html, body { width: 210mm; margin: 0; padding: 0; }
            body { display: block; height: auto; overflow: visible; background: #fff; }
            .sidebar, .menu-btn, .overlay { display: none !important; }
            .main { padding: 0; margin: 0; display: block; overflow: visible; }
            .sheet {
                box-shadow: none;
                width: 210mm;
                height: 297mm;
                min-height: 0;
                margin: 0;
                box-sizing: border-box;
                gap: 5mm;
            }
            .problem-box { border: none; }
        }

        /* ç§»åŠ¨ç«¯ï¼šæŠ½å±‰ä¾§æ  + å±å¹•å‹å¥½é¢„è§ˆ */
        @media (max-width: 860px) {
            .menu-btn { display: inline-flex; }
            body { height: 100dvh; overflow: hidden; }

            .sidebar {
                position: fixed;
                top: 0; left: 0; bottom: 0;
                width: min(320px, 86vw);
                transform: translateX(-105%);
                box-shadow: 2px 0 24px rgba(0,0,0,0.18);
                border-right: 1px solid rgba(0,0,0,0.08);
                z-index: 250;
            }
            .sidebar.open { transform: translateX(0); }
            .sidebar-close { display: inline-flex; }

            .main {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding: 68px 12px 28px;
                justify-content: flex-start;
            }

            .sheet {
                width: 100%;
                min-height: auto;
                padding: 12px;
                gap: 12px;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                grid-template-rows: auto;
            }

            .counter-svg { width: 92px; height: 128px; }
        }
    </style>
</head>
<body>

    <button class="menu-btn" type="button" aria-label="æ‰“å¼€èœå•" onclick="toggleSidebar(true)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <line x1="4" y1="7" x2="20" y2="7"></line>
            <line x1="4" y1="12" x2="20" y2="12"></line>
            <line x1="4" y1="17" x2="20" y2="17"></line>
        </svg>
    </button>
    <div class="overlay" id="overlay" onclick="toggleSidebar(false)"></div>

    <aside class="sidebar" id="sidebar">
        <button class="sidebar-close" type="button" aria-label="å…³é—­èœå•" onclick="toggleSidebar(false)">Ã—</button>
        <a href="../" class="back-link">â† è¿”å› YoBox å¤§å…</a>
        <div class="title">ğŸ§® æ•°ä½è®¡æ•°å™¨</div>
        <div class="subtitle">é’ˆå¯¹11-20è®¤è¯†ï¼šç”»ç å­ã€å†™æ•°å­—</div>

        <div class="control-group">
            <span class="label">é¢˜ç›®ç±»å‹</span>
            <select id="typeSelect" onchange="generate()">
                <option value="mix">æ··åˆç»ƒä¹  (æ¨è)</option>
                <option value="read">çœ‹ç å­å†™æ•°</option>
                <option value="draw">çœ‹æ•°å­—ç”»ç å­</option>
            </select>
        </div>

        <div class="control-group">
            <span class="label">æ•°å­—èŒƒå›´</span>
            <select id="rangeSelect" onchange="generate()">
                <option value="11-20">11-20 (é‡ç‚¹)</option>
                <option value="0-20">0-20 (å«ä¸ªä½æ•°)</option>
            </select>
        </div>

        <button class="btn-refresh" onclick="generate()">ğŸ”„ æ¢ä¸€æ‰¹é¢˜ç›®</button>
        <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ç«‹å³æ‰“å°</button>
        
        <div style="margin-top:20px; font-size:12px; color:#999; line-height:1.5;">
            * æ‰“å°æŠ€å·§ï¼š<br>
            é¢˜ç›®åŒ…å«â€œå†™0å ä½â€ç­‰æ˜“é”™ç‚¹ã€‚<br>
            å»ºè®®è®©å­©å­è¾¹ç”»è¾¹å¿µï¼šâ€œåä½1ä¸ªç ï¼Œä¸ªä½3ä¸ªç â€ã€‚
        </div>
    </aside>

    <main class="main">
        <div class="sheet" id="sheet"></div>
    </main>

    <script>
        function toggleSidebar(forceOpen) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            if (!sidebar || !overlay) return;
            const open = typeof forceOpen === 'boolean' ? forceOpen : !sidebar.classList.contains('open');
            sidebar.classList.toggle('open', open);
            overlay.classList.toggle('active', open);
        }
        window.addEventListener('resize', () => {
            if (!window.matchMedia('(max-width: 860px)').matches) toggleSidebar(false);
        });

        function generate() {
            const sheet = document.getElementById('sheet');
            sheet.innerHTML = '';
            const type = document.getElementById('typeSelect').value;
            const range = document.getElementById('rangeSelect').value;
            
            for (let i = 0; i < 16; i++) {
                let num;
                if (range === '11-20') {
                    const rand = Math.random();
                    if(rand < 0.15) num = 10;
                    else if(rand < 0.3) num = 20;
                    else num = Math.floor(Math.random() * 10) + 11;
                } else {
                    num = Math.floor(Math.random() * 21);
                }

                let mode = type;
                if (type === 'mix') mode = Math.random() > 0.5 ? 'read' : 'draw';

                const box = document.createElement('div');
                box.className = 'problem-box';
                
                const tens = Math.floor(num / 10);
                const ones = num % 10;
                const drawTens = mode === 'draw' ? 0 : tens;
                const drawOnes = mode === 'draw' ? 0 : ones;

                box.appendChild(createCounterSVG(drawTens, drawOnes));

                const answerDiv = document.createElement('div');
                answerDiv.className = 'answer-area';
                
                if (mode === 'read') {
                    answerDiv.innerHTML = `( <div class="bracket"></div> )`;
                } else {
                    answerDiv.innerHTML = `( <div class="bracket" style="border:none; font-weight:bold">${num}</div> )`;
                }
                
                box.appendChild(answerDiv);
                if (mode === 'draw') {
                    const tip = document.createElement('div');
                    tip.className = 'text-desc';
                    tip.innerText = "ç”»ä¸€ç”»";
                    box.appendChild(tip);
                }
                sheet.appendChild(box);
            }
        }

        function createCounterSVG(tens, ones) {
            const W = 100, H = 140;
            const X_TENS = 30, X_ONES = 70; 
            const BASE_Y = 110; 
            const BEAD_R = 6; 
            const BEAD_H = 14; 

            const ns = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(ns, "svg");
            svg.setAttribute("class", "counter-svg");
            svg.setAttribute("viewBox", `0 0 ${W} ${H}`);

            let html = `
                <path d="M10 ${BASE_Y} L90 ${BASE_Y} L90 ${BASE_Y+10} L10 ${BASE_Y+10} Z" fill="#333" />
                <line x1="${X_TENS}" y1="20" x2="${X_TENS}" y2="${BASE_Y}" stroke="#333" stroke-width="2" />
                <line x1="${X_ONES}" y1="20" x2="${X_ONES}" y2="${BASE_Y}" stroke="#333" stroke-width="2" />
                <text x="${X_TENS}" y="${BASE_Y+25}" font-size="12" text-anchor="middle" font-family="KaiTi">åä½</text>
                <text x="${X_ONES}" y="${BASE_Y+25}" font-size="12" text-anchor="middle" font-family="KaiTi">ä¸ªä½</text>
            `;

            for (let i = 0; i < tens; i++) {
                const cy = BASE_Y - BEAD_R - 2 - (i * BEAD_H);
                html += `<circle cx="${X_TENS}" cy="${cy}" r="${BEAD_R}" fill="#333" />`;
            }
            for (let i = 0; i < ones; i++) {
                const cy = BASE_Y - BEAD_R - 2 - (i * BEAD_H);
                html += `<circle cx="${X_ONES}" cy="${cy}" r="${BEAD_R}" fill="#333" />`;
            }
            svg.innerHTML = html;
            return svg;
        }

        window.onload = generate;
    </script>
</body>
</html>
